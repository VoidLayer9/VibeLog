<h1>Memory Management Rituals in C</h1>

<p>Memory management in C is a discipline that separates novice coders from system architects. In long-running daemons and server applications, a single missed <code>free()</code> can slowly consume all available RAM, eventually bringing the entire system to its knees.</p>

<h2>The Basics: malloc and free</h2>

<p>At its core, dynamic memory in C revolves around two functions: <code>malloc()</code> to allocate and <code>free()</code> to release. But the simplicity is deceptive. Every allocation creates an obligation — a contract that the programmer must honor.</p>

<pre><code>void *ptr = malloc(1024);
if (!ptr) {
    // Handle allocation failure
    return -1;
}
// ... use the memory ...
free(ptr);
ptr = NULL; // Prevent dangling pointer</code></pre>

<h2>Arena Allocators: The Superior Pattern</h2>

<p>For high-performance applications, arena (or region-based) allocators offer a paradigm shift. Instead of tracking individual allocations, you allocate from a large pre-reserved block and free everything at once.</p>

<pre><code>typedef struct {
    char *base;
    size_t offset;
    size_t capacity;
} Arena;

void *arena_alloc(Arena *a, size_t size) {
    if (a->offset + size > a->capacity) return NULL;
    void *ptr = a->base + a->offset;
    a->offset += size;
    return ptr;
}

void arena_reset(Arena *a) {
    a->offset = 0;
}</code></pre>

<h2>Common Pitfalls</h2>

<ul>
    <li><strong>Double free</strong>: Freeing the same pointer twice leads to undefined behavior and potential security vulnerabilities.</li>
    <li><strong>Use after free</strong>: Accessing memory after it has been freed. The data may still be there, or it may be overwritten — a Heisenbug.</li>
    <li><strong>Memory fragmentation</strong>: Repeated small allocations and frees can fragment the heap, making large allocations fail even with sufficient total memory.</li>
</ul>

<h2>Tools of the Trade</h2>

<p>Use <code>valgrind</code> to detect leaks, <code>AddressSanitizer</code> for buffer overflows, and custom logging wrappers around <code>malloc</code>/<code>free</code> to track allocation patterns in production systems.</p>

<p>Memory management is not a chore — it is a ritual. Respect it, and your daemons will run forever.</p>
